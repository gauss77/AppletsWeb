<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Debugging</title><meta content="DocBook XSL Stylesheets V1.75.2" name="generator"><link rel="home" href="index.html" title="Java2Script User's Guide"><link rel="up" href="chap-j2s-plugin.html" title="Chapter&nbsp;5.&nbsp;The J2S plugin"><link rel="prev" href="rer.html" title="Application launching"><link rel="next" href="ch05s05.html" title="Command line API"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section" title="Debugging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N103CE"></a>Debugging</h2></div></div></div><p>how turn on debuggin?</p><p>what happens when debug is on?</p><div class="section" title="JavaScript ClassLoader and Hotspot"><div class="titlepage"><div><div><h3 class="title"><a name="N103D5"></a>JavaScript ClassLoader and Hotspot</h3></div></div></div><p>If you are familiar with Java debugging, you must know there is a technology called "Hotspot". One feature of Hotspot is to replace 
  old classes bytecodes with a new ones that are generated by dynamic compilers. This feature helps developers a lot in debugging. 
  That is to say, when a developer load a very complex application in debugging mode, he want to modify the sources a little, he can just 
  do it, the compiler will compile those related classes and notify classloader to load those affected classes bytecodes. So the changes are loaded in
  an application being executed without the need of reloading it.
  It saves lots of time by avoiding closing, reopening and waiting big applications again and again. This is very convenient when comparing to those 
  static compiled applications written by C or C++ languages.</p><p>Let's try it with an example. The following java test, creates an html button with a click event handle. Each time the user clicks the button, 
  the instance method <code class="code">doCLickAction()</code> is called. </p><pre class="programlisting">
package org.sgx.j2s.js;

import org.sgx.j2s.html.HTMLUtils;

public class HotSpotTest1 {
  int counter = 0;  
  
  public static void main(String[] args) {
    new HotSpotTest1().test();
  }
  
  public void test() {
    
    //creates an html button element in document.body, with label "click me" and 
    //with an event handler that will call doCLickAction() instance method
    
    HTMLUtils.createButton(JsUtils.document().body, "click me", new Runnable() {
      public void run() {
        counter++;
        doClickAction();
      }
    });   
  }

  protected void doClickAction() {
    System.out.println(counter+" say hello!");
  }

}
</pre><p>Now we will use J2S Hot Spot for debugging the application making changes to sources that will be reflected in the html document 
without having to reload the application. For debugging a J2S application with HotSpot, we use Debug As... instead of Run As... in the context menu:</p><div class="figure"><a name="N103E5"></a><p class="title"><b>Figure&nbsp;5.1.&nbsp;Debug As... Java2Script application context menu</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/j2s-debug-as.png" alt="Debug As... Java2Script application context menu"></div></div></div><br class="figure-break"><p>This will execute our application that will show a button labeled "click me". If we click the button once a message is printed: </p><div class="figure"><a name="N103EF"></a><p class="title"><b>Figure&nbsp;5.2.&nbsp;HotSpot debugging the application - first screenshot</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/hotspot-app-1.png" alt="HotSpot debugging the application - first screenshot"></div></div></div><br class="figure-break"><p>Now the interesting part. Change the message printed in the method <code class="code">doClickAction()</code>, for example:</p><pre class="programlisting">
protected void doClickAction() {
  System.out.println(counter+" say hello CRUEL WORLD!");
}
</pre><p>Save the changes and keep looking at your application at the J2S console. 
After a few seconds, you should see a red label "Application loaded":
</p><div class="figure"><a name="N10401"></a><p class="title"><b>Figure&nbsp;5.3.&nbsp;HotSpot debugging the application - application change notification</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/hotspot-app-2.png" alt="HotSpot debugging the application - application change notification"></div></div></div><br class="figure-break"><p>That means the J2S HotSpot mechanish has detected changes in classes of current application, 
and the application has loaded the new changes. So, we can click the button again, and will see
the new message printed:
</p><div class="figure"><a name="N1040B"></a><p class="title"><b>Figure&nbsp;5.4.&nbsp;HotSpot debugging the application - changes were applied</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/hotspot-app-3.png" alt="HotSpot debugging the application - changes were applied"></div></div></div><br class="figure-break"><p>W just were able of modify the application and reflect those changes all without restarting 
our application, or in other words, we have just make a "hot change" in our application. </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Just like in java, only changes to instance variable and instance methods will be 
supported by HotSpot. Changes to static methods, or changes in class signatures 
(like adding/removing/renaming) methods are not supported by HotSpot.</p></div><h3><a name="asd"></a>
    How is this accomplished?
  </h3><p>
  Java2Script also implements JavaScript's Hotspot technology. Such JavaScript Hotspot technology is not complicate, because JavaScript is 
  already a very robust and convenient language to do so. All Java2Script implementation is to clean those classes' declaration inside JavaScript 
  class inheritance system simulator. And then reload the *.js using Java2Script's classloader. In the implementation, classloader does not change 
  class or object's prototype when a reloaded class is redefined, it's possible to keep all classes relationships without breaking those already 
  instantiated instances.
  </p><p>
  To trigger Java2Script class simulator to Hotspot swapping, there is a thread trying to load an 
  updating JavaScript classes list from Java2Script compiler in Eclipse. Its work is simple, just 
  trying to load http://127.0.0.1:1725/&lt;session&gt;.js. And the server listening on default port 
  1725 is started by Java2Script compiler, called "Java2Script Inner Hotspot Server (J2SIHS)". 
  When a compiling occurs, compiler will notify this server that a class is updated, and the server 
  will add the information to the list. Once a JavaScript request arrives, it will send out the list 
  according to the request session id. And when the JavaScript client thread gets the updated classes 
  list, it will try to unload related classes and reload them. That is the rough procedure of
   Java2Script Hotspot technology.
  </p><p>
By using Hotspot, I think it is much more convenient for me to develop JavaScript RIA in Java codes than before, especially in developing SWT applications.
  </p></div></div></body></html>